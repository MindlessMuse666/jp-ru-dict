openapi: 3.0.3
info:
  title: JP-RU Dictionary API
  description: API для личного русско-японского словаря
  version: 1.0.0
  contact:
    name: API Support
    url: https://github.com/MindlessMuse666/jp-ru-dict
    email: mindlessmuse.666@gmail.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080/api
    description: Локальный сервер разработки
  - url: https://u.menya.ego.poka.cto.net.grustniysmaylik/api
    description: Production сервер

tags:
  - name: auth
    description: Аутентификация и авторизация
  - name: words
    description: Управление словами
  - name: system
    description: Системные endpoints

paths:
  /auth/register:
    post:
      tags:
        - auth
      summary: Регистрация пользователя
      description: Создает нового пользователя и возвращает JWT токен
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRegisterRequest"
      responses:
        "201":
          description: Успешная регистрация
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Неверные данные
        "409":
          description: Пользователь уже существует

  /auth/login:
    post:
      tags:
        - auth
      summary: Вход пользователя
      description: Аутентифицирует пользователя и возвращает JWT токен
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserLoginRequest"
      responses:
        "200":
          description: Успешный вход
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Неверные данные
        "401":
          description: Неверные учетные данные

  /auth/me:
    get:
      tags:
        - auth
      summary: Информация о текущем пользователе
      description: Возвращает информацию о пользователе из JWT токена
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Информация о пользователе
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/User"
        "401":
          description: Неавторизован

  /words:
    get:
      tags:
        - words
      summary: Получить список слов
      description: Возвращает список слов пользователя с курсорной пагинацией
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          description: Лимит слов (макс. 100)
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: cursor
          in: query
          description: Курсор для пагинации
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        "200":
          description: Список слов
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/WordsListResponse"
        "500":
          description: Внутренняя ошибка сервера

    post:
      tags:
        - words
      summary: Создать слово
      description: Создает новое слово в словаре пользователя
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WordCreateRequest"
      responses:
        "201":
          description: Слово создано
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Word"
        "400":
          description: Неверные данные
        "500":
          description: Внутренняя ошибка сервера

  /words/{id}:
    get:
      tags:
        - words
      summary: Получить слово по ID
      description: Возвращает слово по ID с проверкой владельца
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID слова
          schema:
            type: integer
      responses:
        "200":
          description: Слово
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Word"
        "400":
          description: Неверный ID слова
        "404":
          description: Слово не найдено

    patch:
      tags:
        - words
      summary: Обновить слово
      description: Обновляет существующее слово (частичное обновление). Все поля опциональны.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID слова
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WordUpdateRequest"
      responses:
        "200":
          description: Слово обновлено
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Word"
        "400":
          description: Неверные данные или пустой запрос
        "404":
          description: Слово не найдено

    delete:
      tags:
        - words
      summary: Удалить слово
      description: Удаляет слово по ID с проверкой владельца
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID слова
          schema:
            type: integer
      responses:
        "204":
          description: Слово удалено
        "400":
          description: Неверный ID слова
        "404":
          description: Слово не найдено

  /words/search:
    get:
      tags:
        - words
      summary: Поиск слов
      description: Выполняет поиск слов по различным критериям
      security:
        - BearerAuth: []
      parameters:
        - name: q
          in: query
          description: Поисковый запрос (подстрока в jp или ru)
          required: false
          schema:
            type: string
        - name: tags
          in: query
          description: Теги (точное совпадение)
          required: false
          schema:
            type: array
            items:
              type: string
        - name: on
          in: query
          description: Онъёми (точное совпадение)
          required: false
          schema:
            type: array
            items:
              type: string
        - name: kun
          in: query
          description: Кунъёми (точное совпадение)
          required: false
          schema:
            type: array
            items:
              type: string
        - name: limit
          in: query
          description: Лимит слов
          required: false
          schema:
            type: integer
            default: 20
        - name: cursor
          in: query
          description: Курсор для пагинации
          required: false
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: Результаты поиска
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/WordsListResponse"
        "500":
          description: Внутренняя ошибка сервера

  /health:
    get:
      tags:
        - system
      summary: Проверка здоровья
      description: Проверяет, что сервис работает
      responses:
        "200":
          description: Сервис работает
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Type "Bearer" followed by a space and JWT token.

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        email:
          type: string
          example: user@example.com
        name:
          type: string
          example: Иван Иванов
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    UserRegisterRequest:
      type: object
      required:
        - email
        - password
        - name
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 6
          example: password123
        name:
          type: string
          example: Иван Иванов

    UserLoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          example: password123

    AuthResponse:
      type: object
      properties:
        token:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        user:
          $ref: "#/components/schemas/User"

    Word:
      type: object
      properties:
        id:
          type: integer
          example: 1
        user_id:
          type: integer
          example: 1
        jp:
          type: array
          items:
            type: string
          example: ["机", "つくえ"]
        ru:
          type: array
          items:
            type: string
          example: ["стол", "парта"]
        on:
          type: array
          items:
            type: string
          example: ["き"]
        kun:
          type: array
          items:
            type: string
          example: ["つくえ"]
        ex_jp:
          type: array
          maxItems: 3
          items:
            type: string
          example: ["机の上に本がある", "新しい机を買った"]
        ex_ru:
          type: array
          maxItems: 3
          items:
            type: string
          example: ["На столе лежит книга", "Купил новый стол"]
        tags:
          type: array
          maxItems: 5
          items:
            type: string
          example: ["n5", "дом"]
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    WordCreateRequest:
      type: object
      required:
        - jp
        - ru
      properties:
        jp:
          type: array
          minItems: 1
          items:
            type: string
          example: ["机", "つくえ"]
        ru:
          type: array
          minItems: 1
          items:
            type: string
          example: ["стол", "парта"]
        on:
          type: array
          items:
            type: string
          example: ["き"]
        kun:
          type: array
          items:
            type: string
          example: ["つくえ"]
        ex_jp:
          type: array
          maxItems: 3
          items:
            type: string
          example: ["机の上に本がある", "新しい机を買った"]
        ex_ru:
          type: array
          maxItems: 3
          items:
            type: string
          example: ["На столе лежит книга", "Купил новый стол"]
        tags:
          type: array
          maxItems: 5
          items:
            type: string
          example: ["n5", "дом"]

    WordUpdateRequest:
      type: object
      properties:
        jp:
          type: array
          minItems: 1
          items:
            type: string
          example: ["机", "つくえ"]
        ru:
          type: array
          minItems: 1
          items:
            type: string
          example: ["стол", "парта"]
        on:
          type: array
          items:
            type: string
          example: ["き"]
        kun:
          type: array
          items:
            type: string
          example: ["つくえ"]
        ex_jp:
          type: array
          maxItems: 3
          items:
            type: string
          example: ["机の上に本がある"]
        ex_ru:
          type: array
          maxItems: 3
          items:
            type: string
          example: ["На столе лежит книга"]
        tags:
          type: array
          maxItems: 5
          items:
            type: string
          example: ["n5", "дом", "мебель"]

    WordsListResponse:
      type: object
      properties:
        words:
          type: array
          items:
            $ref: "#/components/schemas/Word"
        next_cursor:
          type: integer
          example: 10
        has_more:
          type: boolean
          example: true
