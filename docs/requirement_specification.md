# Техническое задание: Личный русско-японский словарь

## Бизнес-требования (BR)

### Основные бизнес-требования

| ID | Название | Описание | Приоритет |
| --- | --- | --- | --- |
| **BR-001** | Управление личным словарем | Система должна позволять пользователям создавать, читать, обновлять и удалять слова для изучения японского языка | MUST HAVE |
| **BR-002** | Учет особенностей японского языка | Система должна корректно обрабатывать особенности японской письменности, включая разделение чтений на онъёми и кунъёми | MUST HAVE |
| **BR-003** | Эффективный поиск | Пользователи должны иметь возможность быстро находить слова по критериям: русскому переводу, японскому написанию, тегам | SHOULD HAVE |
| **BR-004** | Организация слов по темам | Система должна позволять группировать слова с помощью тегов для лучшей организации процесса изучения | SHOULD HAVE |
| **BR-005** | Отслеживание прогресса | Система должна сохранять историю создания и обновления слов для анализа прогресса изучения | COULD HAVE |
| **BR-006** | Импорт данных | Пользователи должны иметь возможность импортировать слова из CSV-файлов | COULD HAVE |
| **BR-007** | Экспорт данных | Пользователи должны иметь возможность экспортировать слова в CSV-файл | WON'T HAVE |

### Технические бизнес-требования

| ID | Название | Описание | Приоритет |
| --- | --- | --- | --- |
| **BR-008** | Простая интеграция с Kafka | Система должна обеспечивать простую и надежную интеграцию с Kafka для асинхронной обработки событий | MUST HAVE |
| **BR-009** | Публичное REST API | Система должна предоставлять хорошо документированное публичное REST API для использования сторонними сервисами и интеграциями | MUST HAVE |

## Функциональные требования (FR)

### Управление словами

| ID | Название | Описание | Приоритет |
| --- | --- | --- | --- |
| **FR-001** | Создание слова | Система должна позволять создавать новые слова с обязательными полями (ru, jp) и опциональными (on, kun, ex_jp, ex_ru, tags) | MUST HAVE |
| **FR-002** | Адаптивное отображение слов | Интерфейс должен адаптивно отображать информацию о словах в зависимости от размера экрана. Всегда отображаются ru и jp, остальные поля скрываются по мере уменьшения экрана | MUST HAVE |
| **FR-003** | Редактирование слова | Система должна позволять обновлять существующие слова | MUST HAVE |
| **FR-004** | Удаление слова | Система должна позволять удалять слова с подтверждением действия | MUST HAVE |
| **FR-005** | Бесконечная лента слов | Система должна реализовывать пагинацию в стиле бесконечной ленты с автоматической подгрузкой при скролле | MUST HAVE |

### Поиск и фильтрация

| ID | Название | Описание | Приоритет |
| --- | --- | --- | --- |
| **FR-006** | Основной поиск | Система должна предоставлять поиск по полям ru и jp | SHOULD HAVE |
| **FR-007** | Расширенный поиск | Система должна предоставлять фильтрацию по тегам, онъёми и кунъёми | SHOULD HAVE |
| **FR-008** | Пагинация с курсором | Система должна реализовывать курсорную пагинацию для бесконечной ленты | MUST HAVE |

### Импорт данных

| ID | Название | Описание | Приоритет |
| --- | --- | --- | --- |
| **FR-009** | Импорт CSV | Система должна позволять импортировать слова из CSV-файлов | COULD HAVE |
| **FR-010** | Валидация импорта | Система должна проверять дубликаты при импорте по полям ru и jp | COULD HAVE |
| **FR-011** | Обработка ошибок импорта | Система должна предоставлять детальную информацию об ошибках при импорте CSV | COULD HAVE |

### Пользовательский интерфейс

| ID | Название | Описание | Приоритет |
| --- | --- | --- | --- |
| **FR-012** | Адаптивный дизайн | Интерфейс должен корректно отображаться на мобильных устройствах и планшетах | MUST HAVE |
| **FR-013** | Мгновенное обновление UI | Изменения в интерфейсе должны отображаться мгновенно с последующей асинхронной синхронизацией с сервером | SHOULD HAVE |
| **FR-014** | Индикаторы загрузки | Система должна показывать индикаторы загрузки при выполнении операций | SHOULD HAVE |

## Нефункциональные требования (NFR)

### Архитектурные требования

| ID | Название | Описание | Приоритет |
| --- | --- | --- | --- |
| **NFR-001** | Конфигурация через переменные окружения | Все настройки должны храниться в переменных окружения и конфигурационных файлах | MUST HAVE |
| **NFR-002** | Документация кода на русском | Весь код должен содержать стандартизированные докстринги на русском языке | MUST HAVE |
| **NFR-003** | Модульность SQL запросов | SQL-запросы должны храниться отдельно от кода и динамически подгружаться | SHOULD HAVE |
| **NFR-004** | Оптимистичные обновления UI | Клиентская часть должна поддерживать оптимистичные обновления с откатом при ошибках сервера | SHOULD HAVE |
| **NFR-005** | Горизонтальное масштабирование | Архитектура должна поддерживать увеличение количества экземпляров сервисов для обработки растущей нагрузки | COULD HAVE |

### Требования к производительности

| --- | --- | --- | --- |
| ID | Название | Описание | Приоритет |
| **NFR-006** | Время отклика API | Время ответа API не должно превышать 200мс для 95% запросов | SHOULD HAVE |
| **NFR-007** | Обработка одновременных запросов | Система должна обрабатывать не менее 100 одновременных пользователей | SHOULD HAVE |
| **NFR-008** | Эффективное использование памяти | Приложение должно эффективно использовать память при работе с большими наборами данных | SHOULD HAVE |

### Требования к надежности

| --- | --- | --- | --- |
| ID | Название | Описание | Приоритет |
| **NFR-009** | Обработка ошибок | Система должна корректно обрабатывать ошибки и предоставлять понятные сообщения пользователю | MUST HAVE |
| **NFR-010** | Отказоустойчивость Kafka | При недоступности Kafka система должна логировать события в консоль и продолжать работу | MUST HAVE |
| **NFR-011** | Восстановление после сбоев | Система должна восстанавливаться после перезапуска без потери данных | MUST HAVE |

### Требования к API

| --- | --- | --- | --- |
| ID | Название | Описание | Приоритет |
| **NFR-012** | Документация OpenAPI | API должно быть полностью описано в формате OpenAPI 3.0 | MUST HAVE |
| **NFR-013** | Стандартизированные ответы | Все ответы API должны следовать единому формату { "data": ... } или { "error": ... } | MUST HAVE |
| **NFR-014** | CORS поддержка | API должно поддерживать CORS для кросс-доменных запросов | MUST HAVE |

## Требования к модели базы данных (DBR)

### Таблица: words

| Поле | Тип | Ограничения | Описание |
| --- | --- | --- | --- |
| **id** | SERIAL | PRIMARY KEY | Уникальный идентификатор |
| **ru** | TEXT[] | NOT NULL | Переводы на русский  |
| **jp** | TEXT[] | NOT NULL | Написания на японском |
| **on** | TEXT[] | NULLABLE | Онъёми чтения |
| **kun** | TEXT[] | NULLABLE | Кунъёми чтения |
| **ex_jp** | TEXT[] | NULLABLE | Примеры на японском |
| **ex_ru** | TEXT[] | NULLABLE | Переводы примеров |
| **tags** | TEXT[] | NULLABLE | Теги для категоризации |
| **created_at** | TIMESTAMPTZ | DEFAULT NOW() | Время создания |
| **updated_at** | TIMESTAMPTZ | DEFAULT NOW() | Время обновления |

### Индексы и оптимизации

```sql
-- Основные индексы для поиска
CREATE INDEX idx_words_ru ON words USING GIN(ru);
CREATE INDEX idx_words_jp ON words USING GIN(jp);
CREATE INDEX idx_words_tags ON words USING GIN(tags);
CREATE INDEX idx_words_created_at ON words(created_at DESC);

-- Частичные индексы для часто используемых запросов
CREATE INDEX idx_words_onyomi ON words USING GIN("on") WHERE "on" IS NOT NULL;
CREATE INDEX idx_words_kunyomi ON words USING GIN(kun) WHERE kun IS NOT NULL;

-- Триггер для автоматического обновления updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_words_updated_at 
    BEFORE UPDATE ON words 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();
```

## Стандарты разработки

### Документирование кода

#### Структуры данных

```go
// Word представляет слово в словаре пользователя
// Содержит основную информацию о японском слове и его переводе
type Word struct {
    ID  int       `json:"id" db:"id"`
    Ru  []string  `json:"ru" db:"ru"`   // Переводы на русский язык
    Jp  []string  `json:"jp" db:"jp"`   // Написания на японском
    // ... остальные поля
}
```

#### Функции и методы

```go
// CreateWord создает новое слово в словаре пользователя
// 
// Параметры:
//   - ctx: контекст выполнения для отмены и таймаутов
//   - word: структура с данными нового слова
//
// Возвращает:
//   - *Word: созданное слово с заполненным ID
//   - error: ошибка валидации или базы данных
func (s *WordService) CreateWord(ctx context.Context, word Word) (*Word, error) {
    // реализация
}
```

#### Модули и пакеты

```go
// Package repository предоставляет слой доступа к данным
// 
// Включает:
//   - WordRepository: работа со словами
//   - MigrationManager: управление миграциями БД
//   - QueryLoader: загрузка SQL запросов из файлов
package repository
```

#### Конфигурация приложения

```go
// Config содержит все настройки приложения
type Config struct {
    Database DatabaseConfig `yaml:"database" envPrefix:"DB_"`
    Server   ServerConfig   `yaml:"server" envPrefix:"SRV_"`
    Kafka    KafkaConfig    `yaml:"kafka" envPrefix:"KAFKA_"`
    Features FeatureFlags   `yaml:"features"`
}

// DatabaseConfig настройки подключения к PostgreSQL
type DatabaseConfig struct {
    Host     string `yaml:"host" env:"HOST" default:"localhost"`
    Port     int    `yaml:"port" env:"PORT" default:"5432"`
    User     string `yaml:"user" env:"USER" default:"app_user"`
    Password string `yaml:"password" env:"PASSWORD" required:"true"`
    Name     string `yaml:"name" env:"NAME" default:"jp_ru_dict"`
    SSLMode  string `yaml:"ssl_mode" env:"SSL_MODE" default:"disable"`
}
```

## План реализации

### Фаза №1: Базовая функциональность (MUST HAVE)

- настройка проекта и Docker окружения;
- модель данных и миграции БД;
- базовые CRUD операции API;
- простой фронтенд для тестирования.

### Фаза №2: Пользовательский интерфейс (MUST HAVE)

- фдаптивный интерфейс Vue.js;
- бесконечная лента с пагинацией;
- формы создания и редактирования слов;
- базовая валидация данных.

### Фаза №3: Поиск и фильтрация (SHOULD HAVE)

- основной и расширенный поиск;
- фильтрация по тегам и чтениям;
- оптимизация производительности поиска.

### Фаза №4: Дополнительные функции (COULD HAVE)

- импорт и экспорт CSV данных;
- интеграция с Kafka;
- расширенные возможности UI.
