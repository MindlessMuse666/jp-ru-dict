import{d as Z,r as b,a as C,u as H,b as V,w as G,c as _,o as w,e as r,f as A,g as $,v as M,t as N,n as F,h as ee,i as S,j as E,T as te,k as re,l as se,m as k,p as ne,q,F as oe,s as ae}from"./main-DPH9I6cG.js";const Q=Z("words",()=>{const e=b([]),t=b(!1),a=b(null),f=b(!0),c=b(0);return{words:e,loading:t,error:a,hasMore:f,nextCursor:c,fetchWords:async(s=20,u=!1)=>{var v,p;if(!t.value){t.value=!0,a.value=null,u&&(e.value=[],c.value=0,f.value=!0);try{const d={limit:s,cursor:c.value},o=await C.get("/words",{params:d}),{data:y}=o.data;e.value=[...e.value,...y.words],c.value=y.next_cursor,f.value=y.has_more}catch(d){a.value=((p=(v=d.response)==null?void 0:v.data)==null?void 0:p.error)||"Ошибка при загрузке слов",console.error("Ошибка при загрузке слов:",d)}finally{t.value=!1}}},searchWords:async(s={})=>{var u,v;t.value=!0,a.value=null;try{const p=await C.get("/words/search",{params:s}),{data:d}=p.data;e.value=d.words,c.value=d.next_cursor,f.value=d.has_more}catch(p){a.value=((v=(u=p.response)==null?void 0:u.data)==null?void 0:v.error)||"Ошибка при поиске слов",console.error("Ошибка при поиске слов:",p)}finally{t.value=!1}},createWord:async s=>{var u,v;try{const d=(await C.post("/words",s)).data.data;return e.value=[d,...e.value],{success:!0,word:d}}catch(p){return{success:!1,error:((v=(u=p.response)==null?void 0:u.data)==null?void 0:v.error)||"Ошибка при создании слова"}}},updateWord:async(s,u)=>{var v,p;try{const o=(await C.patch(`/words/${s}`,u)).data.data,y=e.value.findIndex(W=>W.id===s);return y!==-1&&(e.value[y]=o),{success:!0,word:o}}catch(d){return{success:!1,error:((p=(v=d.response)==null?void 0:v.data)==null?void 0:p.error)||"Ошибка при обновлении слова"}}},deleteWord:async s=>{var u,v;try{return await C.delete(`/words/${s}`),e.value=e.value.filter(p=>p.id!==s),{success:!0}}catch(p){return{success:!1,error:((v=(u=p.response)==null?void 0:u.data)==null?void 0:v.error)||"Ошибка при удалении слова"}}},clearWords:()=>{e.value=[],c.value=0,f.value=!0,a.value=null}}}),le={__name:"WordCard",props:{word:{type:Object,required:!0},isCompactView:{type:Boolean,default:!0}},emits:["edit","delete"],setup(e,{emit:t}){return H(),Q(),()=>{}}},ie={__name:"WordFormModal",props:{isOpen:{type:Boolean,default:!1},word:{type:Object,default:null}},emits:["close","saved"],setup(e,{emit:t}){const a=e;H();const f=b(!1);b(!1);const c=b(!1),l=b(""),i=V({jp:[""],ru:[""],on:[""],kun:[""],ex_jp:[""],ex_ru:[""],tags:[]}),m=V({});G(()=>a.isOpen,n=>{n&&(h(),a.word?(f.value=!0,x(a.word)):f.value=!1)});const x=n=>{i.jp=[...n.jp],i.ru=[...n.ru],i.on=n.on&&n.on.length>0?[...n.on]:[""],i.kun=n.kun&&n.kun.length>0?[...n.kun]:[""],i.ex_jp=n.ex_jp&&n.ex_jp.length>0?[...n.ex_jp]:[""],i.ex_ru=n.ex_ru&&n.ex_ru.length>0?[...n.ex_ru]:[""],i.tags=n.tags&&n.tags.length>0?[...n.tags]:[],l.value=i.tags.join(", ")},h=()=>{i.jp=[""],i.ru=[""],i.on=[""],i.kun=[""],i.ex_jp=[""],i.ex_ru=[""],i.tags=[],l.value="",c.value=!1,Object.keys(m).forEach(n=>delete m[n])};return()=>{}}};var de=typeof global=="object"&&global&&global.Object===Object&&global,ce=typeof self=="object"&&self&&self.Object===Object&&self,X=de||ce||Function("return this")(),I=X.Symbol,Y=Object.prototype,ue=Y.hasOwnProperty,fe=Y.toString,O=I?I.toStringTag:void 0;function me(e){var t=ue.call(e,O),a=e[O];try{e[O]=void 0;var f=!0}catch{}var c=fe.call(e);return f&&(t?e[O]=a:delete e[O]),c}var pe=Object.prototype,ve=pe.toString;function ge(e){return ve.call(e)}var ye="[object Null]",xe="[object Undefined]",z=I?I.toStringTag:void 0;function be(e){return e==null?e===void 0?xe:ye:z&&z in Object(e)?me(e):ge(e)}function he(e){return e!=null&&typeof e=="object"}var we="[object Symbol]";function ke(e){return typeof e=="symbol"||he(e)&&be(e)==we}var _e=/\s/;function je(e){for(var t=e.length;t--&&_e.test(e.charAt(t)););return t}var Se=/^\s+/;function We(e){return e&&e.slice(0,je(e)+1).replace(Se,"")}function U(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var R=NaN,Te=/^[-+]0x[0-9a-f]+$/i,Ce=/^0b[01]+$/i,Oe=/^0o[0-7]+$/i,$e=parseInt;function D(e){if(typeof e=="number")return e;if(ke(e))return R;if(U(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=U(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=We(e);var a=Ce.test(e);return a||Oe.test(e)?$e(e.slice(2),a?2:8):Te.test(e)?R:+e}var L=function(){return X.Date.now()},Me="Expected a function",Ee=Math.max,Ie=Math.min;function Be(e,t,a){var f,c,l,i,m,x,h=0,n=!1,s=!1,u=!0;if(typeof e!="function")throw new TypeError(Me);t=D(t)||0,U(a)&&(n=!!a.leading,s="maxWait"in a,l=s?Ee(D(a.maxWait)||0,t):l,u="trailing"in a?!!a.trailing:u);function v(g){var j=f,T=c;return f=c=void 0,h=g,i=e.apply(T,j),i}function p(g){return h=g,m=setTimeout(y,t),n?v(g):i}function d(g){var j=g-x,T=g-h,P=t-j;return s?Ie(P,l-T):P}function o(g){var j=g-x,T=g-h;return x===void 0||j>=t||j<0||s&&T>=l}function y(){var g=L();if(o(g))return W(g);m=setTimeout(y,d(g))}function W(g){return m=void 0,u&&f?v(g):(f=c=void 0,i)}function J(){m!==void 0&&clearTimeout(m),h=0,f=x=c=m=void 0}function K(){return m===void 0?i:W(L())}function B(){var g=L(),j=o(g);if(f=arguments,c=this,x=g,j){if(m===void 0)return p(x);if(s)return clearTimeout(m),m=setTimeout(y,t),v(x)}return m===void 0&&(m=setTimeout(y,t)),i}return B.cancel=J,B.flush=K,B}const Le={class:"mb-6"},Ve={class:"relative mb-4"},Ae={class:"mb-4"},Ne={key:0,class:"bg-gray-50 rounded-lg p-4 border"},Fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ue={__name:"SearchBar",emits:["search","advanced-search"],setup(e,{emit:t}){const a=t,f=b(!1),c=b(""),l=V({tags:"",on:"",kun:""}),i=Be(()=>{a("search",c.value.trim())},500),m=()=>{i()},x=()=>{const n={};l.tags.trim()&&(n.tags=l.tags.split(",").map(s=>s.trim())),l.on.trim()&&(n.on=l.on.split(",").map(s=>s.trim())),l.kun.trim()&&(n.kun=l.kun.split(",").map(s=>s.trim())),a("advanced-search",n)},h=()=>{l.tags="",l.on="",l.kun="",a("advanced-search",{})};return G(c,n=>{n.trim()===""&&h()}),(n,s)=>(w(),_("div",Le,[r("div",Ve,[s[5]||(s[5]=r("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[r("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),$(r("input",{"onUpdate:modelValue":s[0]||(s[0]=u=>c.value=u),type:"text",placeholder:"Поиск по японскому или русскому...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition-colors",onInput:m},null,544),[[M,c.value]])]),r("div",Ae,[r("button",{onClick:s[1]||(s[1]=u=>f.value=!f.value),class:"text-sm text-primary hover:text-primary/80 flex items-center"},[r("span",null,N(f.value?"Скрыть":"Показать")+" расширенный поиск",1),(w(),_("svg",{class:F(["w-4 h-4 ml-1 transition-transform",{"rotate-180":f.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...s[6]||(s[6]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),A(te,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"transform opacity-0 -translate-y-4","enter-to-class":"transform opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"transform opacity-100 translate-y-0","leave-to-class":"transform opacity-0 -translate-y-4"},{default:ee(()=>[f.value?(w(),_("div",Ne,[r("div",Fe,[r("div",null,[s[7]||(s[7]=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[E(" Теги "),r("span",{class:"text-xs text-gray-500 ml-1"},"(через запятую)")],-1)),$(r("input",{"onUpdate:modelValue":s[2]||(s[2]=u=>l.tags=u),type:"text",placeholder:"n5, дом, мебель",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[M,l.tags]])]),r("div",null,[s[8]||(s[8]=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[E(" Онъёми "),r("span",{class:"text-xs text-gray-500 ml-1"},"(через запятую)")],-1)),$(r("input",{"onUpdate:modelValue":s[3]||(s[3]=u=>l.on=u),type:"text",placeholder:"き, しょう",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[M,l.on]])]),r("div",null,[s[9]||(s[9]=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[E(" Кунъёми "),r("span",{class:"text-xs text-gray-500 ml-1"},"(через запятую)")],-1)),$(r("input",{"onUpdate:modelValue":s[4]||(s[4]=u=>l.kun=u),type:"text",placeholder:"つくえ, た",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[M,l.kun]])])]),r("div",{class:"mt-4 flex justify-end space-x-3"},[r("button",{onClick:h,class:"px-4 py-2 text-sm text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"}," Сбросить "),r("button",{onClick:x,class:"px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-primary/90 rounded-md transition-colors"}," Применить фильтры ")])])):S("",!0)]),_:1})]))}},He={class:"flex justify-center items-center py-8"},Pe={__name:"LoadingSpinner",setup(e){return(t,a)=>(w(),_("div",He,[...a[0]||(a[0]=[r("div",{class:"relative"},[r("div",{class:"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin"}),r("div",{class:"absolute inset-0 flex items-center justify-center"},[r("span",{class:"text-sm text-gray-600"},"Загрузка...")])],-1)])]))}},qe={class:"max-w-6xl mx-auto"},ze={class:"mb-6"},Re={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4"},De={key:0,class:"text-sm text-gray-600"},Ge={class:"flex items-center space-x-4"},Qe={class:"flex items-center"},Xe={key:0,class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg"},Ye={class:"flex items-center"},Je={class:"text-red-800"},Ke={key:1,class:"text-center py-12"},Ze={key:2},et={class:"space-y-4"},tt={key:1,class:"mt-6 text-center"},rt={key:2,class:"mt-6 pt-6 border-t text-center"},nt={__name:"HomeView",setup(e){const t=Q(),{showSuccess:a,showError:f}=H(),c=b(!0),l=b(!1),i=b(!1),m=b(null),x=()=>{const d=window.innerHeight+window.scrollY,o=document.documentElement.offsetHeight-200;d>=o&&!t.loading&&t.hasMore&&h()},h=()=>{t.fetchWords()},n=async d=>{d.trim()?await t.searchWords({q:d}):t.fetchWords(20,!0)},s=async d=>{await t.searchWords(d)},u=d=>{m.value=d,i.value=!0},v=async d=>{try{let o;m.value?o=await t.updateWord(m.value.id,d):o=await t.createWord(d),o.success?a(m.value?"Слово успешно обновлено":"Слово успешно добавлено"):f(o.error)}catch{f("Ошибка при сохранении слова")}},p=()=>{l.value=!1,i.value=!1,m.value=null};return re(()=>{t.words.length===0&&t.fetchWords(),window.addEventListener("scroll",x)}),se(()=>{window.removeEventListener("scroll",x)}),(d,o)=>(w(),_("div",qe,[r("div",ze,[r("div",Re,[r("div",null,[o[2]||(o[2]=r("h2",{class:"text-2xl font-bold text-gray-800"},"Мой словарь",-1)),k(t).words.length?(w(),_("p",De," Всего слов: "+N(k(t).words.length),1)):S("",!0)]),r("div",Ge,[r("div",Qe,[o[3]||(o[3]=r("span",{class:"text-sm text-gray-700 mr-2"},"Компактный вид:",-1)),r("button",{onClick:o[0]||(o[0]=y=>c.value=!c.value),class:F(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors",c.value?"bg-primary":"bg-gray-200"])},[r("span",{class:F(["inline-block h-4 w-4 transform rounded-full bg-white transition-transform",c.value?"translate-x-6":"translate-x-1"])},null,2)],2)]),r("button",{onClick:o[1]||(o[1]=y=>l.value=!0),class:"px-4 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-md transition-colors flex items-center"},[...o[4]||(o[4]=[r("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),E(" Добавить слово ",-1)])])])]),A(Ue,{onSearch:n,onAdvancedSearch:s})]),k(t).error?(w(),_("div",Xe,[r("div",Ye,[o[5]||(o[5]=r("svg",{class:"w-5 h-5 text-red-500 mr-3",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),r("span",Je,N(k(t).error),1)])])):S("",!0),!k(t).loading&&k(t).words.length===0?(w(),_("div",Ke,[...o[6]||(o[6]=[ne('<div class="text-gray-400 mb-4"><svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg></div><h3 class="text-lg font-medium text-gray-700 mb-2">Словарь пуст</h3><p class="text-gray-500 mb-4">Добавьте первое слово, нажав кнопку &quot;Добавить слово&quot;</p>',3)])])):(w(),_("div",Ze,[r("div",et,[(w(!0),_(oe,null,ae(k(t).words,y=>(w(),q(le,{key:y.id,word:y,"is-compact-view":c.value,onEdit:W=>u(y)},null,8,["word","is-compact-view","onEdit"]))),128))]),k(t).loading&&k(t).words.length>0?(w(),q(Pe,{key:0})):S("",!0),!k(t).loading&&k(t).hasMore?(w(),_("div",tt,[r("button",{onClick:h,class:"px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium rounded-lg transition-colors"}," Загрузить еще ")])):S("",!0),!k(t).hasMore&&k(t).words.length>0?(w(),_("div",rt,[...o[7]||(o[7]=[r("p",{class:"text-gray-500"},"Вы просмотрели все слова в словаре",-1)])])):S("",!0)])),A(ie,{"is-open":l.value||i.value,word:m.value,onClose:p,onSaved:v},null,8,["is-open","word"])]))}};export{nt as default};
